<%= form_with(model: @message, local: true, html: { class: "message-form" }) do |f| %>
  <% if @message.errors.any? %>
    <section class="form-errors">
      <h3>Se encontraron <%= pluralize(@message.errors.count, "error") %> al intentar enviar el mensaje:</h3>
      <ul>
        <% @message.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </section>
  <% end %>

  <fieldset>
    <legend>Nuevo mensaje</legend>

    <div class="form-group">
      <%= f.label :chat_id, "Conversación" %>
      <%= f.select :chat_id, @chats.map { |chat|
      users_names = chat.users.where.not(id: current_user.id).map { |u| "#{u.first_name} #{u.last_name}" }.join(", ")
      ["Chat con #{users_names}", chat.id]
    }, prompt: 'Elige una conversación', class: "select-input" %>
    </div>

    <div class="form-group">
      <%= f.label :recipient_id, "Destinatario" %>
      <%= f.select :recipient_id, @users.map { |user| ["#{user.first_name} #{user.last_name}", user.id] }, prompt: 'Elige al destinatario', class: "select-input" %>
    </div>

    <div class="form-group">
      <%= f.label :body, "Contenido del mensaje" %>
      <%= f.text_area :body, class: "textarea-input", rows: 4, placeholder: "Escribe tu mensaje aquí..." %>
    </div>
  </fieldset>

  <div class="form-actions">
    <%= f.submit "Enviar mensaje", class: "submit-btn" %>
  </div>
<% end %>
